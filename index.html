<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏–∫–∞–∑–æ–≤</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 950px; margin: 40px auto; padding: 0 20px; background: #f5f5f5; }
  h1 { color: #2c3e50; }
  .form-block { background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
  label { display: block; font-weight: bold; margin: 10px 0 3px; color: #34495e; }
  input, select { width: 100%; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
  .input-with-hint { position: relative; }
  .hint-list { position: absolute; z-index: 100; background: white; border: 1px solid #ccc; border-radius: 4px; width: 100%; max-height: 150px; overflow-y: auto; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
  .hint-item { padding: 8px 12px; cursor: pointer; font-size: 14px; }
  .hint-item:hover { background: #e8f4fd; }
  .person-block { border: 1px solid #d0e4f0; border-radius: 6px; padding: 14px 16px; margin-top: 12px; background: #f0f7fc; position: relative; }
  .person-title { font-weight: bold; color: #1a5276; margin-bottom: 6px; font-size: 13px; }
  .remove-btn { position: absolute; top: 10px; right: 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 3px 10px; cursor: pointer; font-size: 13px; }
  .remove-btn:hover { background: #c0392b; }
  .add-btn { margin-top: 12px; padding: 8px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
  .add-btn:hover { background: #1e8449; }
  .gen-btn { margin-top: 16px; padding: 10px 28px; background: #2980b9; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 15px; }
  .gen-btn:hover { background: #1a6fa3; }
  .genitive-preview { font-size: 12px; color: #7f8c8d; margin-top: 2px; min-height: 16px; }
  .genitive-preview span { color: #27ae60; font-style: italic; }
  #preview {
    background: white; padding: 60px 70px; border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    font-family: "Times New Roman", serif; font-size: 12pt;
    line-height: 1; display: none;
  }
  #preview p, #preview div { margin: 0; padding: 0; line-height: 1; }
  .pr-center  { text-align: center; }
  .pr-bold    { font-weight: bold; }
  .pr-justify { text-align: justify; }
  .pr-gap     { height: 12pt; display: block; }
  .pr-header-table { width: 100%; border-collapse: collapse; }
  .pr-header-table td { border: none; padding: 0; font-size: 12pt; line-height: 1.3; }
  .pr-sign-table { width: 100%; border-collapse: collapse; }
  .pr-sign-table td { border: none; padding: 0; font-weight: bold; font-size: 12pt; line-height: 1; }
  .pr-annex-table { width: 100%; border-collapse: collapse; }
  .pr-annex-table th { border: 1px solid #000; padding: 4px 6px; text-align: center; font-size: 12pt; font-weight: bold; background: #f0f0f0; }
  .pr-annex-table td { border: 1px solid #000; padding: 4px 6px; font-size: 12pt; text-align: left; }
  .pr-annex-table td:first-child { text-align: center; }
  .page-break-label { border-top: 3px dashed #aaa; margin: 24px 0 16px; text-align: center; color: #aaa; font-size: 11px; }
  .btn-row { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
  .btn-docx { background: #1a5276; color: white; border: none; border-radius: 4px; padding: 10px 24px; cursor: pointer; font-size: 15px; }
  .btn-docx:hover { background: #154360; }
  .btn-copy { background: #27ae60; color: white; border: none; border-radius: 4px; padding: 10px 24px; cursor: pointer; font-size: 15px; }
  .btn-copy:hover { background: #1e8449; }
  .status { padding: 8px 14px; border-radius: 4px; margin-top: 10px; font-size: 13px; display: none; }
  .status.ok  { background: #d4edda; color: #155724; display: block; }
  .status.err { background: #f8d7da; color: #721c24; display: block; }
  .info-badge { background: #d6eaf8; color: #1a5276; border-radius: 4px; padding: 8px 14px; font-size: 13px; margin-bottom: 12px; }
  .saved-tag  { font-size: 11px; color: #27ae60; margin-left: 6px; }
</style>
</head>
<body>

<h1>üìÑ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏–∫–∞–∑–æ–≤</h1>

<div class="form-block">
  <label>–¢–∏–ø –ø—Ä–∏–∫–∞–∑–∞:</label>
  <select id="templateSelect" onchange="renderFields()">
    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏–∫–∞–∑–∞ ‚Äî</option>
    <option value="tosi">–ü—Ä–∏–∫–∞–∑ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–∞ –¢–û –°–ò</option>
    <option value="bosi">–ü—Ä–∏–∫–∞–∑ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–∞ –ë–û –°–ò</option>
  </select>
  <div id="baseFields"></div>
  <div id="personsBlock"></div>
  <div id="addBtnWrap" style="display:none">
    <button class="add-btn" onclick="addPerson()">Ôºã –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ</button>
  </div>
  <br>
  <button class="gen-btn" onclick="generateDoc()">‚ñ∂ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
</div>

<div id="statusMsg" class="status"></div>
<div id="preview"></div>
<div class="btn-row" id="btnRow" style="display:none">
  <button class="btn-docx" onclick="downloadDocx()">üìÑ –°–∫–∞—á–∞—Ç—å .docx (Word)</button>
  <button class="btn-copy" onclick="copyDoc()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/petrovich/petrovich.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>

const DIRECTOR      = "–ï–º–µ–ª—å—è–Ω–µ–Ω–∫–æ –ú–∞–∫—Å–∏–º –°–µ—Ä–≥–µ–µ–≤–∏—á";
const DIRECTOR_POST = "–î–∏—Ä–µ–∫—Ç–æ—Ä –û–û–û ¬´–°–¢–î–í¬ª";
const FONT = "Times New Roman";
const SZ   = 24;
const SZ_S = 24;
const MONTHS = ["—è–Ω–≤–∞—Ä—è","—Ñ–µ–≤—Ä–∞–ª—è","–º–∞—Ä—Ç–∞","–∞–ø—Ä–µ–ª—è","–º–∞—è","–∏—é–Ω—è",
                "–∏—é–ª—è","–∞–≤–≥—É—Å—Ç–∞","—Å–µ–Ω—Ç—è–±—Ä—è","–æ–∫—Ç—è–±—Ä—è","–Ω–æ—è–±—Ä—è","–¥–µ–∫–∞–±—Ä—è"];
const STORAGE_CONTRACTS = "prikaz_contracts";
const STORAGE_OBJECTS   = "prikaz_objects";
const STORAGE_SHEETS    = "prikaz_sheets_url";

// =============================================
//  –í–®–ò–¢–´–ô URL ‚Äî –º–µ–Ω—è—Ç—å –∑–¥–µ—Å—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
// =============================================
const SHEETS_URL_DEFAULT = "https://script.google.com/macros/s/AKfycbxY4tc95PzxzfALM8FZ6WQlyMtGBpkdjOgozMCvG-QBj-Tk-V8X3S-YEmgGJfcsQW8I/exec";

// =============================================
//  localStorage
// =============================================
function getSaved(key){ try{return JSON.parse(localStorage.getItem(key))||[];}catch(e){return[];} }
function addSaved(key,value){
  if(!value) return;
  let arr=getSaved(key);
  if(!arr.includes(value)){arr.unshift(value);if(arr.length>20)arr=arr.slice(0,20);}
  localStorage.setItem(key,JSON.stringify(arr));
}
function 
